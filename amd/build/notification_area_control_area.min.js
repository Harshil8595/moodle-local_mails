function _typeof(a){"@babel/helpers - typeof";if("function"==typeof Symbol&&"symbol"==typeof Symbol.iterator){_typeof=function(a){return typeof a}}else{_typeof=function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a}}return _typeof(a)}define ("local_mails/notification_area_control_area",["jquery","core/templates","core/notification","core/custom_interaction_events","local_mails/notification_repository","local_mails/notification_area_events","message_popup/notification_area_control_area"],function(a,b,c,d,e,f,g){var h={CONTAINER:"[data-region=\"mails-area\"]",CONTENT:"[data-region=\"content\"]",NOTIFICATION:"[data-region=\"mails-content-item-container\"]",CAN_RECEIVE_FOCUS:"input:not([type=\"hidden\"]), a[href], button, textarea, select, [tabindex]",TYPE:"[data-type]",COUNT_CONTAINER:"[data-region=\"mails-count-container\"]"},i={NOTIFICATION:"local_mails/notification_content_item"},j=function(b,c){this.root=a(b);this.container=this.root.closest(h.CONTAINER);this.userId=c;this.content=this.root.find(h.CONTENT);this.offset=0;this.limit=20;this.initialLoad=!1;this.isLoading=!1;this.loadedAll=!1;this.notifications={};this.type=this.container.data("type");this.registerEventListeners()};j.prototype=Object.create(g.prototype);j.prototype.constructor=j;j.prototype.getNotificationElement=function(a){var b=this.getRoot().find(h.NOTIFICATION+"[data-id=\""+a+"\"]");return 1==b.length?b:null};j.prototype.showNotification=function(b){if("object"!==_typeof(b)){b=this.getNotificationElement(b)}if(b&&b.length){this.getRoot().find(h.NOTIFICATION).removeClass("selected");b.addClass("selected").find(h.CAN_RECEIVE_FOCUS).focus();var c=b.attr("data-id"),d=this.getCacheNotification(c);this.scrollNotificationIntoView(b);this.getContainer().trigger(f.showNotification,[a.extend({},d)])}};j.prototype.markNotificationAsRead=function(a){return e.markAsRead(a.attr("data-id")).done(function(){a.removeClass("unread");a.find(".unread").remove()})};j.prototype.renderNotifications=function(c){var d=[],e=this.getContent();a.each(c,function(a,c){var e=c.contexturl;delete c.contexturl;var f=b.render(i.NOTIFICATION,c).then(function(a,b){c.contexturl=e;this.setCacheNotification(c);return{html:a,js:b}}.bind(this));d.push(f)}.bind(this));return a.when.apply(a,d).then(function(){a.each(arguments,function(a,c){e.append(c.html);b.runTemplateJS(c.js)})})};j.prototype.loadMoreNotifications=function(){if(this.isLoading||this.hasLoadedAllContent()){return a.Deferred().resolve()}this.startLoading();var b={limit:this.getLimit(),offset:this.getOffset(),useridto:this.getUserId(),type:this.getType()};if(!this.initialLoad){b.limit=this.getOffset()+this.getLimit();b.offset=0}var c=e.query(b).then(function(a){var b=a.notifications;this.unreadCount=a.unreadcount;this.setLoadedAllContent(!b.length||b.length<this.getLimit());this.initialLoad=!0;if(b.length){this.incrementOffset();return this.renderNotifications(b)}return!1}.bind(this)).always(function(){this.stopLoading()}.bind(this));return c};j.prototype.registerEventListeners=function(){d.define(this.getRoot(),[d.events.activate,d.events.scrollBottom,d.events.scrollLock,d.events.up,d.events.down]);d.define(this.getContent(),[d.events.scrollBottom]);this.getRoot().on(d.events.scrollBottom,function(){this.loadMoreNotifications()}.bind(this));this.getRoot().on(d.events.activate,h.TYPE,function(b){var c=a(b.target);this.setOffset(0);this.setLoadedAllContent(!1);this.setType(parseInt(c.data("type")));this.getContainer().trigger(f.clearNotifications);this.getContent().empty();this.loadMoreNotifications();c.parent().find(h.TYPE).removeClass("active");c.addClass("active")}.bind(this));this.getRoot().on(d.events.activate,h.NOTIFICATION,function(b){var c=a(b.target).closest(h.NOTIFICATION);this.showNotification(c)}.bind(this));this.getRoot().on(d.events.up,h.NOTIFICATION,function(b,c){var d=a(b.target).closest(h.NOTIFICATION);this.showNotification(d.prev());c.originalEvent.preventDefault()}.bind(this));this.getRoot().on(d.events.down,h.NOTIFICATION,function(b,c){var d=a(b.target).closest(h.NOTIFICATION);this.showNotification(d.next());if(d.next().is(":last-child")){this.loadMoreNotifications()}c.originalEvent.preventDefault()}.bind(this));this.getContainer().on(f.notificationShown,function(a,b){if(!b.read){var c=this.getNotificationElement(b.id);if(c){this.markNotificationAsRead(c)}var d=this.getCacheNotification(b.id);if(d){d.read=!0}}}.bind(this))};j.prototype.getType=function(){return this.type};j.prototype.setType=function(a){this.type=a};return j});
//# sourceMappingURL=notification_area_control_area.min.js.map
